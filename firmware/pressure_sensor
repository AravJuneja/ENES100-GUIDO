from machine import ADC, Pin
from time import sleep

scale_sensor = ADC(Pin(34))
scale_sensor.atten(ADC.ATTN_11DB)
scale_sensor.width(ADC.WIDTH_12BIT)

ADC_MIN = 120
ADC_MAX = 2850
GRAMS_MAX = 5000.0

PLASTIC_THRESHOLDS = {"low": 3300, "high": 3800}
FOAM_THRESHOLDS = {"low": 92, "high": 577}

def read_average(samples=10, delay_time=0.01):
    total = 0
    for _ in range(samples):
        total += scale_sensor.read()
        sleep(delay_time)
    return total / samples

def adc_to_grams(reading):
    reading = max(ADC_MIN, min(reading, ADC_MAX))
    return (reading - ADC_MIN) * GRAMS_MAX / (ADC_MAX - ADC_MIN)

def classify_weight(reading, is_plastic):
    thresholds = PLASTIC_THRESHOLDS if is_plastic else FOAM_THRESHOLDS
    if reading < thresholds["low"]:
        return "low"
    elif reading > thresholds["high"]:
        return "heavy"
    else:
        return "medium"

is_plastic = False

while True:
    raw_value = read_average()
    weight_g = adc_to_grams(raw_value)
    weight_class = classify_weight(raw_value, is_plastic)
    print("ADC: {:4.0f}  â†’  Weight Class: {} g".format(raw_value, weight_class))
    print("Weight in grams: {:.0f}".format(weight_g))
    sleep(0.5)

